function Button(t,e){var i=this;i.$el=t,i.count=0,i.$title=t.find(".tmf-btn__title"),i.$subtitle=t.find(".tmf-btn__subtitle"),i.action=new BulkAction(e),i.$el.on("click",function(){i.$el.addClass("tmf-btn--active"),i.$title.text(i.count),i.action.paused?(i.action.proceed(),i.$subtitle.text("Click to pause")):(i.action.pause(),i.$subtitle.text("Click to continue"))})}function Profile(t){this.$el=$(".ProfileCard:eq("+t+")"),this.isLoaded()&&(this.$btn=this.$el.find(".user-actions-follow-button"),this.id=this.$el.data("user-id")+"-")}function BulkAction(t){this.callback=t,this.paused=!0}$.fn.isPresent=function(){return this.length>0};var USER_ID=$("#user-dropdown").find("[data-user-id]").data("user-id"),Record={storage:chrome.storage.local,key:USER_ID.toString(),get:function(t){var e=this;this.storage.get(this.key,function(i){e.result=i,t.call()})},set:function(){this.storage.set(this.result)},add:function(t){this.result[this.key]?this.result[this.key]+=t:this.result[this.key]=t,this.set()},includes:function(t){return this.result[this.key]?this.result[this.key].includes(t):!1}},tmf={init:function(){var t=this;t.$el=$("<div>").addClass("tmf animated").appendTo("body")},toggle:function(){var t=this;this.$el.removeClass("flipInY flipOutY tmf--active"),$(".ProfileCard").length>10?t.$el.load(chrome.extension.getURL("html/actions.html"),{},function(){$(".tmf-btn").on("click",function(){t.$el.addClass("tmf--active")}),t.followBtn=new Button($(".tmf-btn--follow"),function(){this.follow()}),t.unfollowBtn=new Button($(".tmf-btn--unfollow"),function(){this.unfollow()}),t.$el.addClass("flipInY");var e=new MutationObserver(function(e){e.forEach(function(e){var i=$("#message-drawer").html();i.includes("66885")&&t.followBtn.setIdle()})});e.observe(document.getElementById("message-drawer"),{subtree:!0,characterData:!0,childList:!0}),$("#tmf_without_exception").on("change",function(){t.withoutException=this.checked,this.checked?(t.followBtn.$subtitle.text("without exception"),t.unfollowBtn.$subtitle.text("without exception")):(t.followBtn.$subtitle.text("who have never been unfollowed"),t.unfollowBtn.$subtitle.text("who do not follow you"))})}):this.$el.addClass("flipOutY")},withoutException:!1};$.extend(Button.prototype,{incrementCount:function(){this.count++,this.$title.text(this.count)},setIdle:function(){var t=this;if(!t.action.paused){var e=60;t.action.pause();var i=setInterval(function(){t.action.paused?(t.$subtitle.text("Continuing in "+e+" seconds..."),0==e?(clearInterval(i),$("#message-drawer").find(".message-text").text(""),t.$el.click()):e--):clearInterval(i)},1e3)}}}),$.extend(Profile.prototype,{isLoaded:function(){return this.$el.isPresent()},isFollowing:function(){return this.$el.find(".FollowStatus").isPresent()},isNotFollowing:function(){return!this.isFollowing()},isFollowable:function(){return this.$btn.children(".follow-text").is(":visible")},isFollowed:function(){return this.$btn.children(".following-text").is(":visible")},follow:function(){this.isFollowable()&&(tmf.withoutException||!Record.includes(this.id)?(this.click(),tmf.followBtn.incrementCount()):this.log("warn","Already unfollowed once"))},unfollow:function(){this.isFollowed()&&(tmf.withoutException||this.isNotFollowing())&&(this.click(),tmf.unfollowBtn.incrementCount(),Record.add(this.id))},click:function(){this.log("success",'Clicked on "'+this.$btn.children(":visible").text().trim()+'"'),this.$btn.click(),this.clicked=!0},log:function(t,e){$("<div>").addClass("tmf-log").addClass("tmf-log--"+t).text(e).insertBefore(this.$el.find(".ProfileCard-bio"))}}),$.extend(BulkAction.prototype,{nth:0,loadAttempts:0,_loadProfiles:function(){this.loadAttempts<10&&(this.last.$btn.focus(),this.loadAttempts++,this._sleep(700))},_sleep:function(t){var e=this;setTimeout(function(){e.run()},t)},run:function(){if(!this.paused){var t=new Profile(this.nth);t.isLoaded()?(this.loadAttempts=0,this.callback.call(t),this.last=t,this.nth++,t.clicked?this._sleep(100):this.run()):this._loadProfiles()}},pause:function(){this.paused=!0},proceed:function(){this.paused=!1,this.run()}}),Record.get(function(){tmf.init(),tmf.toggle()});var observer=new MutationObserver(function(t){t.forEach(function(t){tmf.toggle()})});observer.observe(document.querySelector("head > title"),{subtree:!0,characterData:!0,childList:!0});